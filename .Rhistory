#1 cleaning
data1 <- readRDS("MktCapTopCoins.rds")
head(data1)
View(data1)
data2 <- readRDS("Top10_cryptoStablePairs.rds")
View(data2)
distinct(data2$market)
library(tidyverse)
install.packages("tidyverse")
library(tidyverse)
distinct(data2$market)
#1 cleaning
data1 <- read_rds("MktCapTopCoins.rds")
head(data1)
data2 <- read_rds("Top10_cryptoStablePairs.rds")
head(data2)
distinct(data2$market)
unique.data.frame(data2$market)
data1 <- as.data.frame(readRDS("MktCapTopCoins.rds"))
head(data1)
data2 <- as.data.frame(readRDS("Top10_cryptoStablePairs.rds"))
head(data2)
distinct(data2$market)
distinct(data2)
distinct(data2,market)
table(data2$market)
data2 %>%
group_by(market) %>%
summarise(n=n(),
start=min(time),
end=max(time))
data2 %>%
group_by(market) %>%
summarise(n=n(),
start=min(time),
end=max(time)) %>%
head(32)
summary <- data2 %>%
group_by(market) %>%
summarise(n=n(),
start=min(time),
end=max(time))
View(summary)
summary2 <- summary <- data2 %>%
group_by(market, time) %>%
summarise(n=n())
View(summary2)
summary2 <- summary <- data2 %>%
group_by(market, month(time)) %>%
summarise(n=n())
summary2 <- summary <- data2 %>%
mutate(month = month(time))
group_by(market, month) %>%
summarise(n=n())
summary2 <- data2 %>%
mutate(month = month(time))
group_by(market, month) %>%
summarise(n=n())
View(data2)
data2 <- mutate(data2, month = month(time))
summary2 <- data2 %>%
group_by(market, month) %>%
summarise(n=n())
View(summary2)
data2 <- mutate(data2, month = month(time), year = year(time))
summary2 <- data2 %>%
group_by(market, year, month) %>%
summarise(n=n())
View(summary)
View(summary)
summary <- data2 %>%
group_by(market) %>%
summarise(n=n(),
start=min(time),
end=max(time))
View(summary)
View(data1)
View(summary)
View(data1)
distinct(data1,asset)
View(data2)
View(summary)
strsplit(as.character(data2$market), "-")[2]
strsplit(as.character(data2$market), "-")
strsplit(as.character(data2$market), "-")[,2]
strsplit(as.character(data2$market), "-")[2,]
sapply(strsplit(as.character(data2$market), "-"), function(x) x[2])
data3 <- data2
data3$asset <- sapply(strsplit(as.character(data2$market), "-"), function(x) x[2])
View(data3)
distinct(data3,asset)
View(data1)
View(data1)
#1 cleaning
data1 <- as.data.frame(readRDS("MktCapTopCoins.rds"))
data2 <- as.data.frame(readRDS("Top10_cryptoStablePairs.rds"))
View(data2)
# Factor
library(pivottabler)
View(data2)
View(data2)
data2$coin <- strsplit(data2$market)[2]
data2$coin <- strsplit(data2$market,"-")[2]
strsplit(data2$market,"-")
lapply(data2$market,strsplit("-"))
lapply(data2$market,strsplit(split = "-"))
lapply(data2$market,strsplit())
lapply(data2$market,strsplit
）
# 合并前，提取asset
data2$asset <- sapply(strsplit(as.character(data2$market), "-"), function(x) x[2])
?qhpvt
price_close <- qhpvt(data2,"asset","time","mean(price_close)")
price_close <- qhpvt(data2,"asset","time","mean(price_close)")
price_close <- qhpvt(data2,"time","asset","n()")
price_close <- PivotTable$new()
price_close$addData(data2)
price_close$addRowDataGroups("time")
price_close$addColumnDataGroups("asset")
price_close$defineCalculation(calculationName="price_close", summariseExpression="mean()")
price_close$renderPivot()
price_close$defineCalculation(calculationName="price_close", summariseExpression="mean(price_close)")
price_close <- PivotTable$new()
price_close$addData(data2)
price_close$addRowDataGroups("time")
price_close$addColumnDataGroups("asset")
price_close$defineCalculation(calculationName="price_close", summariseExpression="mean(price_close)")
price_close$renderPivot()
# Factor
library(tidyverse)
?pivot_longer
# Factor
library(reshape2)
dcast(data2, time~asset, value.var = "price_close", mean)
price_close <- dcast(data2, time~asset, value.var = "price_close", mean)
View(price_close)
volume <- dcast(data2, time~asset, value.var = "volume", mean)
View(volume)
col(price_close)
names(price_close)
names(price_close)[2:11]
price_close <- mutate(across(names(price_close)[2:11], lag(n=7), .names = "{.col}_lag1"))
View(price_close)
price_close <- price_close %>%
mutate(across(names(price_close)[2:11], lag(n=7), .names = "{.col}_lag1"))
price_close <- price_close %>%
mutate(across(names(price_close)[2:11], lag, .names = "{.col}_lag1"))
price_close <- dcast(data2, time~asset, value.var = "price_close", mean)
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(lag1 = ~lag(.x, 7),
lag2 = ~lag(.x, 14),
lag3 = ~lag(.x, 21),
lag4 = ~lag(.x, 28),
lag8 = ~lag(.x, 56)),
.names = "{.col}_{.fn}"))
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(mom1 = ~ .x -get(paste0(cur_column(), "_lag1")),
mom2 = ~ .x -get(paste0(cur_column(), "_lag2")),
mom3 = ~ .x -get(paste0(cur_column(), "_lag3")),
mom4 = ~ .x -get(paste0(cur_column(), "_lag4")),
mom8 = ~ .x -get(paste0(cur_column(), "_lag8"))),
.names = "{.col}_{.fn}"))
View(price_close)
library(slider)
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(std1 = ~slide2_dbl(.x, sd, .before = 7, .complete = TRUE),
std2 = ~slide2_dbl(.x, sd, .before = 14, .complete = TRUE),
std3 = ~slide2_dbl(.x, sd, .before = 21, .complete = TRUE),
std4 = ~slide2_dbl(.x, sd, .before = 28, .complete = TRUE),
std8 = ~slide2_dbl(.x, sd, .before = 56, .complete = TRUE)),
.names = "{.col}_{.fn}"))
slide_dbl(data2$btc, sd, .before = 2, .complete = TRUE)
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(std1 = ~slide_dbl(.x, sd, .before = 7, .complete = TRUE),
std2 = ~slide_dbl(.x, sd, .before = 14, .complete = TRUE),
std3 = ~slide_dbl(.x, sd, .before = 21, .complete = TRUE),
std4 = ~slide_dbl(.x, sd, .before = 28, .complete = TRUE),
std8 = ~slide_dbl(.x, sd, .before = 56, .complete = TRUE)),
.names = "{.col}_{.fn}"))
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(rmom1 = ~ get(paste0(cur_column(), "_mom1"))/get(paste0(cur_column(), "_std1")),
rmom2 = ~ get(paste0(cur_column(), "_mom2"))/get(paste0(cur_column(), "_std2")),
rmom3 = ~ get(paste0(cur_column(), "_mom3"))/get(paste0(cur_column(), "_std3")),
rmom4 = ~ get(paste0(cur_column(), "_mom4"))/get(paste0(cur_column(), "_std4")),
rmom8 = ~ get(paste0(cur_column(), "_mom8"))/get(paste0(cur_column(), "_std8"))),
.names = "{.col}_{.fn}"))
volume <- volume %>%
mutate(across(names(price_close)[2:11],
list(vol = ~ log(slide_dbl(.x, mean, .before = 7, .complete = TRUE))),
.names = "{.col}_{.fn}"))
price_close$get(paste0("ada", "_mom1"))
price_close$paste0("ada", "_mom1")
?get
View(data1)
data1$CapMkt <- ifelse(!is.na(data1$CapMrktCurUSD), data1$CapMrktCurUSD, data1$CapMrktEstUSD)
CapMkt <- dcast(data1, time ~ asset, value.var = "CapMkt", mean)
View(CapMkt)
CapMkt$time == price_close$time
sum(CapMkt$time == price_close$time)
price_close$time[0]
price_close$time[1]
price_close$time[-1]
price_close$time[2603]
CapMkt$time < price_close$time[1]
CapMkt$time >= price_close$time[1] & CapMkt$time <= price_close$time[2603]
sum(CapMkt$time >= price_close$time[1] & CapMkt$time <= price_close$time[2603])
CapMkt[CapMkt$time >= price_close$time[1] & CapMkt$time <= price_close$time[2603]]
CapMkt[CapMkt$time >= price_close$time[1] & CapMkt$time <= price_close$time[2603],]
CapMkt <- CapMkt[CapMkt$time >= price_close$time[1] & CapMkt$time <= price_close$time[2603],names(price_close)[1:11]]
View(CapMkt)
rownames(CapMkt) <- NULL
volume <- volume %>%
mutate(across(names(volume)[2:11],
list(volprc = ~ get(paste0(cur_column(), "_vol"))*price_close[[cur_column()]],
volscale = ~ get(paste0(cur_column(), "_vol"))*price_close[[cur_column()]]/CapMkt[[cur_column()]]),
.names = "{.col}_{.fn}"))
dplyr::last_dplyr_warnings()
price_close <- dcast(data2, time~asset, value.var = "price_close", mean) %>%
filter(row_number() <= n()-1)
CapMkt <- dcast(data1, time ~ asset, value.var = "CapMkt", mean)
CapMkt <- CapMkt[CapMkt$time >= price_close$time[1] & CapMkt$time <= price_close$time[2603],names(price_close)[1:11]]
rownames(CapMkt) <- NULL
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(lag1 = ~lag(.x, 7),
lag2 = ~lag(.x, 14),
lag3 = ~lag(.x, 21),
lag4 = ~lag(.x, 28),
lag8 = ~lag(.x, 56)),
.names = "{.col}_{.fn}"))
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(mom1 = ~ .x -get(paste0(cur_column(), "_lag1")),
mom2 = ~ .x -get(paste0(cur_column(), "_lag2")),
mom3 = ~ .x -get(paste0(cur_column(), "_lag3")),
mom4 = ~ .x -get(paste0(cur_column(), "_lag4")),
mom8 = ~ .x -get(paste0(cur_column(), "_lag8"))),
.names = "{.col}_{.fn}"))
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(std1 = ~slide_dbl(.x, sd, .before = 7, .complete = TRUE),
std2 = ~slide_dbl(.x, sd, .before = 14, .complete = TRUE),
std3 = ~slide_dbl(.x, sd, .before = 21, .complete = TRUE),
std4 = ~slide_dbl(.x, sd, .before = 28, .complete = TRUE),
std8 = ~slide_dbl(.x, sd, .before = 56, .complete = TRUE)),
.names = "{.col}_{.fn}"))
price_close <- price_close %>%
mutate(across(names(price_close)[2:11],
list(rmom1 = ~ get(paste0(cur_column(), "_mom1"))/get(paste0(cur_column(), "_std1")),
rmom2 = ~ get(paste0(cur_column(), "_mom2"))/get(paste0(cur_column(), "_std2")),
rmom3 = ~ get(paste0(cur_column(), "_mom3"))/get(paste0(cur_column(), "_std3")),
rmom4 = ~ get(paste0(cur_column(), "_mom4"))/get(paste0(cur_column(), "_std4")),
rmom8 = ~ get(paste0(cur_column(), "_mom8"))/get(paste0(cur_column(), "_std8"))),
.names = "{.col}_{.fn}"))
volume <- dcast(data2, time~asset, value.var = "volume", mean) %>%
filter(row_number() <= n()-1)
volume <- volume %>%
mutate(across(names(volume)[2:11],
list(vol = ~ log(slide_dbl(.x, mean, .before = 7, .complete = TRUE))),
.names = "{.col}_{.fn}"))
volume <- volume %>%
mutate(across(names(volume)[2:11],
list(volprc = ~ get(paste0(cur_column(), "_vol"))*price_close[[cur_column()]],
volscale = ~ get(paste0(cur_column(), "_vol"))*price_close[[cur_column()]]/CapMkt[[cur_column()]]),
.names = "{.col}_{.fn}"))
gc()
gc()
